<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Text Encrypter</title>
</head>
<body>
  <form>
    <label for="textInput">Text:</label><br>
    <textarea id="textInput" rows="4" cols="50"></textarea><br>
    <button type="button" onclick="encryptAndSave()">Save</button>
  </form> 
  <br>
  <button type="button" onclick="readAndDecrypt()">Read</button>
  <br>
  <div id="output"></div>
  <script>
    // Generate a random encryption key
    var key = Math.random().toString(36).substring(2);

    // Generate a random certified key
    var certifiedKey = Math.random().toString(36).substring(2);

    function encrypt(text) {
      // Encrypt the text using the key
      // (Note: this is a very simple encryption algorithm and should not be used for actual security purposes)
      var encryptedText = "";
      for (var i = 0; i < text.length; i++) {
        encryptedText += String.fromCharCode(text.charCodeAt(i) ^ key.charCodeAt(i % key.length));
      }
      return encryptedText;
    }

    function decrypt(encryptedText) {
      // Decrypt the encrypted text using the key
      // (Note: this is a very simple decryption algorithm and should not be used for actual security purposes)
      var text = "";
      for (var i = 0; i < encryptedText.length; i++) {
        text += String.fromCharCode(encryptedText.charCodeAt(i) ^ key.charCodeAt(i % key.length));
      }
      return text;
    }

    function encryptAndSave() {
    // Get the text from the textarea
    var text = document.getElementById("textInput").value;

    // Encrypt the text
    var encryptedText = encrypt(text);

    // Save the encrypted text to a file with the "sf" extension
    window.requestFileSystem(window.TEMPORARY, 1024*1024, function(fs) {
      // Generate a random file name with a maximum of 12 characters
      var fileName = Math.random().toString(36).substring(2, 14) + ".sf";

      fs.root.getFile(fileName, {create: true}, function(fileEntry) {
        fileEntry.createWriter(function(fileWriter) {
          fileWriter.onwriteend = function() {
            // Display a small dialog showing the location of the saved file
            alert("File saved at: " + fileEntry.fullPath);
          };
          fileWriter.onerror = function(error) {
            // Display a dialog for any errors that may occur while saving the file
            alert("Error saving file: " + error.message);
          };
          fileWriter.write(new Blob([encryptedText, certifiedKey], {type: "text/plain"}));
        }, function(error) {
          console.error(error);
        });
      }, function(error) {
        console.error(error);
      });
    }, function(error) {
      console.error(error);
    });
  }
  function readAndDecrypt() {
    // Create a file input element
    var fileInput = document.createElement("input");
    fileInput.type = "file";
    fileInput.accept = ".sf";
    fileInput.click();

    // Set the onchange event handler
    fileInput.onchange = function() {
      // Get the selected file
      var file = fileInput.files[0];

      // Get the file's URL
      var fileUrl = URL.createObjectURL(file);

      // Resolve the file's URL
      window.resolveLocalFileSystemURL(fileUrl, function(entry) {
        // Read the file
        entry.file(function(file) {
          var reader = new FileReader();
          reader.onloadend = function() {
            // Get the encrypted text and the certified key from the file
            var data = this.result;
            var encryptedText = data.slice(0, -32);
            var fileCertifiedKey = data.slice(-32);

            // Verify the authenticity of the file
            if (fileCertifiedKey !== certifiedKey) {
              // Display a dialog indicating that the file is corrupted or modified by other software or platforms
              alert("Error: the encrypted file is corrupted or modified by other software or platforms.");
            } else {
              // Decrypt the text
              var text = decrypt(encryptedText);

              // Display the decrypted text
              document.getElementById("output").innerHTML = text;
            }
          };
          reader.readAsText(file);
        }, function(error) {
          console.error(error);
        });
      }, function(error) {
        console.error(error);
      });
    };
  }
  </script>
</body>
</html>